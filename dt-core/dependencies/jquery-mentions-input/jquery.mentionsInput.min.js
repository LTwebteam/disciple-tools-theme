!function(R,e){var L=0,A=8,M=9,z=13,F=37,H=38,O=39,V=40,j=36,D=35,N={triggerChar:"@",onDataRequest:R.noop,minChars:2,allowRepeat:!1,showAvatars:!0,elastic:!0,defaultValue:"",onCaret:!1,classes:{autoCompleteItemActive:"active"},templates:{wrapper:function(){return'<div class="mentions-input-box"></div>'},autocompleteList:function(){return'<div class="mentions-autocomplete-list"></div>'},autocompleteListItem:function(e){return"<li data-ref-id="+e.id+" data-ref-type="+e.type+" data-display="+e.display+">"+e.content+"</li>"},autocompleteListItemAvatar:function(e){return"<img src="+e.avatar+" />"},autocompleteListItemIcon:function(e){return'<div class="icon"'+e.icon+"></div>"},mentionsOverlay:function(e){return'<div class="mentions"><div></div></div>'},mentionItemSyntax:function(e){return"@["+e.value+"]("+e.type+":"+e.id+")"},mentionItemHighlight:function(e){return"<strong><span>"+e.value+"</span></strong>"}}},W=function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e},$=function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},q=function(e,t){return t||t.length?e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):e},B=function(e,t){if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()},Q=function(e){return e.replace(/\s+$/,"")},a=function(d){var t,f,n,i,a,r,o,g=[],l={},s=[],m="";function v(){var i=x();R.each(g,function(e,t){var n=d.templates.mentionItemSyntax(t);i=i.replace(new RegExp($(t.value),"g"),n)});var o=W(i);R.each(g,function(e,t){var n=R.extend({},t,{value:W(t.value)}),i=d.templates.mentionItemSyntax(n),a=d.templates.mentionItemHighlight(n);o=o.replace(new RegExp($(i),"g"),a)}),o=(o=o.replace(/\n/g,"<br />")).replace(/ {2}/g,"&nbsp; "),f.data("messageText",i),f.trigger("updated"),r.find("div").html(o)}function h(){s=[]}function c(t){for(var e=x(),n=f[0].selectionStart,i=!1,a=!1,o=new RegExp("\\"+d.triggerChar+m,"gi");o.exec(e);)(!1===i||Math.abs(o.lastIndex-n)<i)&&(i=Math.abs(o.lastIndex-n),a=o.lastIndex);var r=a-m.length-1,s=a,l=e.substr(0,r),c=e.substr(s,e.length),u=(l+t.value).length+1;g.find(function(e){return e.id==t.id})||g.push(t),h(),m="",I();var p=l+"@"+t.value+" "+c;f.val(p),f.trigger("mention"),v(),f.focus(),B(f[0],u)}function x(){return R.trim(f.val())}function u(e){var t,n,i=R(this);return c(l[i.attr("data-uid")]),t=R(f).offset().top,n=R("body").offset().top,t<R(window).scrollTop()&&R(window).scrollTop(t-n),!1}function p(e){h()}function y(e){I()}function b(e){var t;v(),t=x(),g=(g=g.filter(function(e){return!(!e.value||-1==t.indexOf(e.value))})).filter(Boolean);var n=s.lastIndexOf(d.triggerChar);-1<n&&(m=s.slice(n+1).join(""),m=Q(m),setTimeout(R.proxy(k,this,m),1))}function w(e){if(e.keyCode!==A){var t=String.fromCharCode(e.which||e.keyCode);s.push(t)}}function C(e){if(e.keyCode===F||e.keyCode===O||e.keyCode===j||e.keyCode===D)return setTimeout(h,1),void(-1<navigator.userAgent.indexOf("MSIE 9")&&setTimeout(v,1));if(e.keyCode!==A){if(!i.is(":visible"))return!0;switch(e.keyCode){case H:case V:var t=null;return(t=e.keyCode===V?o&&o.length?o.next():i.find("li").first():R(o).prev()).length&&T(t),!1;case z:case M:if(o&&o.length)return o.trigger("mousedown"),!1}return!0}s=s.slice(0,-1+s.length)}function I(){o=null,i.empty().hide()}function T(e){e.addClass(d.classes.autoCompleteItemActive),e.siblings().removeClass(d.classes.autoCompleteItemActive),o=e}function S(r,e){if(i.show(),!d.allowRepeat){var t=R.map(g,function(e,t){return _.get(t,"value")});e=e.filter(function(e){return!t.includes(e.name)})}if(e.length){i.empty();var s=R("<ul>").appendTo(i).hide();R.each(e,function(e,t){var n,i,a=(i=L++,(n="mention_")?n+i:i);l[a]=R.extend({},t,{value:t.name});var o=R(d.templates.autocompleteListItem({id:W(t.id),display:W(t.name),type:W(t.type),content:q(W(t.display?t.display:t.name),r)})).attr("data-uid",a);(0===e&&T(o),d.showAvatars)&&(t.avatar?R(d.templates.autocompleteListItemAvatar({avatar:t.avatar})):R(d.templates.autocompleteListItemIcon({icon:t.icon}))).prependTo(o);o=o.appendTo(s)}),i.show(),d.onCaret&&function(e,t){var n=e.css("position");if("absolute"==n){var i=function(e){var t,n,i,a,o,r,s,l,c,u,p;if((c=e[0])&&R(c).is("textarea")&&null!=c.selectionEnd){for(s={position:"absolute",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"content-box",top:0,left:-9999},u=0,p=(l=["boxSizing","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","textDecoration","textIndent","textTransform","width","word-spacing"]).length;u<p;u++)s[o=l[u]]=R(c).css(o);return i=document.createElement("div"),R(i).css(s),R(c).after(i),n=document.createTextNode(c.value.substring(0,c.selectionEnd)),t=document.createTextNode(c.value.substring(c.selectionEnd)),(a=document.createElement("span")).innerHTML="&nbsp;",i.appendChild(n),i.appendChild(a),i.appendChild(t),i.scrollTop=c.scrollTop,r=R(a).position(),R(i).remove(),r}}(t),a=parseInt(t.css("line-height"),10)||18;e.css("width","15em"),e.css("left",i.left),e.css("top",a+i.top);var o=t.offset().left+t.width(),r=e.offset().left+e.width();o<=r&&e.css("left",Math.abs(e.position().left-(r-o)))}else if("fixed"==n){var s=function(e){var t,n,i,a,o,r,s,l,c,u,p;if((c=e[0])&&R(c).is("textarea")&&null!=c.selectionEnd){for(s={position:"absolute",overflow:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",boxSizing:"content-box",top:0,left:-9999},u=0,p=(l=["boxSizing","fontFamily","fontSize","fontStyle","fontVariant","fontWeight","height","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","textDecoration","textIndent","textTransform","width","word-spacing"]).length;u<p;u++)s[o=l[u]]=R(c).css(o);return i=document.createElement("div"),R(i).css(s),R(c).after(i),n=document.createTextNode(c.value.substring(0,c.selectionEnd)),t=document.createTextNode(c.value.substring(c.selectionEnd)),(a=document.createElement("span")).innerHTML="&nbsp;",i.appendChild(n),i.appendChild(a),i.appendChild(t),i.scrollTop=c.scrollTop,r=R(a).offset(),R(i).remove(),r}}(t),a=parseInt(t.css("line-height"),10)||18;e.css("width","15em"),e.css("left",s.left+1e4),e.css("top",a+s.top)}}(i,f),s.show()}else I()}function k(t){"string"==typeof t&&t.length>=d.minChars?d.onDataRequest.call(this,"search",t,function(e){S(t,e)}):I()}function E(e){g=[];for(var t,n=W(e),i=new RegExp("("+d.triggerChar+")\\[(.*?)\\]\\((.*?):(.*?)\\)","gi"),a=n;null!=(t=i.exec(n));)a=a.replace(t[0],t[1]+t[2]),g.push({id:t[4],type:t[3],value:t[2],trigger:t[1]});f.val(a),v()}return d=R.extend(!0,{},N,d),{init:function(e){"true"!==(f=R(t=e)).attr("data-mentions-input")&&(n=f.parent(),a=R(d.templates.wrapper()),f.wrapAll(a),a=n.find("> div.mentions-input-box"),f.attr("data-mentions-input","true"),f.bind("keydown",C),f.bind("keypress",w),f.bind("click",p),f.bind("blur",y),-1<navigator.userAgent.indexOf("MSIE 8")?f.bind("propertychange",b):f.bind("input",b),d.elastic&&f.elastic()),(i=R(d.templates.autocompleteList())).appendTo(a),i.delegate("li","mousedown",u),(r=R(d.templates.mentionsOverlay())).prependTo(a),E(d.defaultValue),d.prefillMention&&c(d.prefillMention)},val:function(e){R.isFunction(e)&&e.call(this,g.length?f.data("messageText"):x())},reset:function(){E()},destroy:function(){var e=function(e){e&&(e.remove(),delete e)};E(d.defaultValue),l={},s=[],g=[],f&&(f.unbind("propertychange",b),f.unbind("input",b),f.unbind("keydown",C),f.unbind("keypress",w),f.unbind("click",p),f.unbind("blur",y),e(f)),e(o),e(r),e(R(t))},reinit:function(){E(!1)},getMentions:function(e){R.isFunction(e)&&e.call(this,g)}}};R.fn.mentionsInput=function(t,n){var i=arguments;return"object"!=typeof t&&t||(n=t),this.each(function(){var e=R.data(this,"mentionsInput")||R.data(this,"mentionsInput",new a(n));return R.isFunction(e[t])?e[t].apply(this,Array.prototype.slice.call(i,1)):"object"!=typeof t&&t?void R.error("Method "+t+" does not exist"):e.init.call(this,this)})}}(jQuery);
